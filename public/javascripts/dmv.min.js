/*! dmv - v0.2.0-16 - 3/9/2012
* https://github.com/rwldrn/dmv
* Copyright (c) 2012 Rick Waldron <waldron.rick@gmail.com>; Licensed MIT */
(function(a,b){var c,d;c=function(a,d){var e=localStorage.getItem("dmv-id");e||(e=c.id(),localStorage.setItem("dmv-id",e)),this.id=e,this.container=document.querySelector(a),this.media=this.fixture("video",this.id),this.canvas=this.fixture("canvas",this.id),this.context=this.canvas.getContext("2d"),this.socket=d,this.dataUri="",b.getUserMedia({video:!0,audio:!0},function(a,b){this.media.src=b&&b||a,this.media.addEventListener("loadedmetadata",function(){this.media.play()}.bind(this),!1),this.media.addEventListener("timeupdate",function(){this.draw()}.bind(this),!1)}.bind(this))},c.prototype.draw=function(){this.context.drawImage(this.media,0,0,this.canvas.width,this.canvas.height)},c.prototype.capture=function(){var a=this.canvas.toDataURL();this.socket.emit("capture",{id:this.id,captured:this.canvas.toDataURL()})},c.prototype.fixture=function(b,c){var d=document.createElement(b),e;return d.id=b[0]+"_"+c,d.style.width=a.innerWidth+"px",this.container||(this.container=document.body),b==="canvas"&&(e=document.querySelector("video[id$='"+c+"']"),setTimeout(function f(){e.videoWidth>0?(d.width=e.videoWidth,d.height=e.videoHeight,d.style.visibility="hidden"):setTimeout(f,10)},10)),this.container.appendChild(d),d},c.id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0;return(a==="x"?b:b&3|8).toString(16)}).toUpperCase()},d={socket:null,operator:null,init:function(a,b){d.socket=b,d.operator=new c(a,b),this.listen(d.operator.media)},listen:function(a){a.addEventListener("click",d.operator.capture.bind(d.operator),!1)}},a.DMV=d,a.Operator=c})(typeof window=="object"&&window||this,this.navigator)